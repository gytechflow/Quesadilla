<ion-header class="ion-no-border">
  <ion-toolbar text-center>
    <ion-buttons slot="start">
      <ion-back-button color="dark" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>
      {{ 'PROFILE.Title' | translate }}
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf=" profileFound; else templateName">
  <br>
  <div class="" class="">
    <div class="head">
      <ion-item lines="none">
        <ion-avatar class="avatar">
          <ion-img [src]="image"></ion-img>
          <!-- <img  src={{source}}> -->
          <div class="camera" (click)="openOptionSelection()">
            <ion-icon name="camera-outline" color="black"></ion-icon>
          </div>
          <div *ngIf="!response" style="margin-top: -60%;">
            <ion-spinner name="lines" color="" class="spin"></ion-spinner>
          </div>
        </ion-avatar>

        <!-- <ion-avatar class="avatar" *ngIf="!image">
            <ion-spinner></ion-spinner>
          </ion-avatar> -->
        <!-- <br>
          <ion-label>{{email}}</ion-label> -->
        <ion-label>
          <p *ngIf="!editname" class="ppp">{{ name }}</p>

          <p *ngIf="!editemail" class="pppp">{{ email }}</p>

        </ion-label>
        <ion-label>
          <ion-button (click)="qrcode()" fill="clear" class="pp" color="black">
            <ion-icon name="qr-code-outline"></ion-icon>
          </ion-button>
        </ion-label>
      </ion-item>
      <br>
    </div>
    <br>
    <br>
    <div class="container">
      <ion-list>
        <form action="" [formGroup]="form">
          <ion-item lines="none">
            <ion-icon slot="start" color="black" name="person-outline"></ion-icon>
            <ion-label>
              <h3 class="text-height">
                <strong> {{ 'PROFILE.Username' | translate }} </strong>
              </h3>
              <p *ngIf="editname">
                <input type="text" [(ngModel)]="name" name="names" clearInput id="" (focus)="nameFocus = false"
                  (blur)="nameBlur($event)" formControlName="names">
              </p>
              <p *ngIf="!editname">{{ name }}</p>
              <p class="ion-float-end" *ngIf="editname && form.get('names').valid" (click)="setEditName(); Save() ">
                <ion-button color="success">
                  <ion-icon name="checkmark-circle" color="light"></ion-icon>
                </ion-button>
              </p>
              <p class="ion-float-end" *ngIf="editname" (click)="setEditName(); resetName() ">
                <ion-button color="danger">
                  <ion-icon name="close-circle" color="light"></ion-icon>
                </ion-button>
              </p>
            </ion-label>
            <p class="ion-float-end" *ngIf="!editname" (click)="setEditName()">
              <ion-icon name="create-outline" color="black"></ion-icon>
            </p>

          </ion-item>
          <ion-item lines="none">
            <ion-icon slot="start" name="call-outline" color="black"></ion-icon>
            <ion-label>
              <h3 class="text-height">
                <strong> {{ 'PROFILE.Phone' | translate }}</strong>
              </h3>
              <p *ngIf="editphone">
                <input type="text" [(ngModel)]="phone" class="form-control lastnamefilter" ng2TelInput
                  [ng2TelInputOptions]="{initialCountry: 'de' }" (countryChange)="onCountryChange($event)" clearInput
                  name="phone" id="" minlength="9" (focus)="phoneFocus = true" (blur)="phoneBlur($event)"
                  formControlName="phone">
              </p>
              <p *ngIf="!editphone">{{ phone }}</p>
              <p class="ion-float-end" *ngIf="editphone && form.get('phone').valid" (click)="setEditPhone(); Save() ">
                <ion-button color="success">
                  <ion-icon name="checkmark-circle" color="light"></ion-icon>
                </ion-button>
              </p>
              <p class="ion-float-end" *ngIf="editphone" (click)="setEditPhone(); resetPhone() ">
                <ion-button color="danger">
                  <ion-icon name="close-circle" color="light"></ion-icon>
                </ion-button>
              </p>
            </ion-label>
            <p class="ion-float-end" *ngIf="!editphone" (click)="setEditPhone()">
              <ion-icon name="create-outline" color="black" mode="md"></ion-icon>
            </p>



          </ion-item>
          <ion-item lines="none">
            <ion-icon slot="start" name="mail-outline" color="black"></ion-icon>
            <ion-label>
              <h3 class="text-height">
                <strong> {{ 'PROFILE.Email' | translate }}</strong>
              </h3>
              <p *ngIf="editemail">
                <input type="text" [(ngModel)]="email" clearInput name="email" id="" (focus)="emailFocus = true"
                  (blur)="emailBlur($event)" formControlName="email">
              </p>
              <p *ngIf="!editemail">
                {{ email }}
              </p>
              <p class="ion-float-end" *ngIf="editemail && form.get('email').valid" (click)="setEditMail(); Save() ">
                <ion-button color="success">
                  <ion-icon name="checkmark-circle" color="light"></ion-icon>
                </ion-button>
              </p>
              <p class="ion-float-end" *ngIf="editemail" (click)="setEditMail(); resetMail() ">
                <ion-button color="danger">
                  <ion-icon name="close-circle" color="light"></ion-icon>
                </ion-button>
              </p>
            </ion-label>
            <p class="ion-float-end" *ngIf="!editemail" (click)="setEditMail()">
              <ion-icon name="create-outline" mode="md" color="black"></ion-icon>
            </p>
          </ion-item>

          <ion-item lines="none">
            <ion-icon slot="start" name="location-outline" color="black"></ion-icon>
            <ion-label>
              <h3 class="text-height">
                <strong> {{ 'PROFILE.Town' | translate }}</strong>
              </h3>
              <p *ngIf="edittown"><input type="text" [(ngModel)]="town" clearInput name="town" id=""
                  (focus)="townFocus = true" (blur)="townBlur($event)" formControlName="town"></p>
              <p *ngIf="!edittown">{{ town }}</p>
              <p class="ion-float-end" *ngIf="edittown && form.get('town').valid" (click)="setEditTown(); Save() ">
                <ion-button color="success">
                  <ion-icon name="checkmark-circle" color="light"></ion-icon>
                </ion-button>
              </p>
              <p class="ion-float-end" *ngIf="edittown" (click)="setEditTown(); resetTown() ">
                <ion-button color="danger">
                  <ion-icon name="close-circle" color="light"></ion-icon>
                </ion-button>
              </p>
            </ion-label>
            <p class="ion-float-end" *ngIf="!edittown" (click)="setEditTown()">
              <ion-icon name="create-outline" mode="md" color="black"></ion-icon>
            </p>


          </ion-item>

          <ion-item lines="none">
            <ion-icon slot="start" name="map-outline" color="black"></ion-icon>
            <ion-label>
              <h3 class="text-height">
                <strong> {{ 'PROFILE.Street' | translate }}</strong>
              </h3>
              <p *ngIf="editstreet"><input type="text" [(ngModel)]="street" clearInput name="street" id=""
                  (focus)="streetFocus = true" (blur)="streetBlur($event)" formControlName="street"></p>
              <p *ngIf="!editstreet">{{ street }}</p>
              <p class="ion-float-end" *ngIf="editstreet && form.get('street').valid"
                (click)="setEditStreet(); Save() ">
                <ion-button color="success">
                  <ion-icon name="checkmark-circle" color="light"></ion-icon>
                </ion-button>
              </p>
              <p class="ion-float-end" *ngIf="editstreet" (click)="setEditStreet(); resetStreet() ">
                <ion-button color="danger">
                  <ion-icon name="close-circle" color="light"></ion-icon>
                </ion-button>
              </p>
            </ion-label>
            <p class="ion-float-end" *ngIf="!editstreet" (click)="setEditStreet()">
              <ion-icon name="create-outline" mode="md" color="black"></ion-icon>
            </p>


          </ion-item>

          <ion-item lines="none">
            <ion-icon slot="start" name="code-outline" color="black"></ion-icon>
            <ion-label>
              <h3 class="text-height">
                <strong> {{ 'PROFILE.Code' | translate }}</strong>
              </h3>
              <p *ngIf="editcode"><input type="text" [(ngModel)]="code" class="form-control" clearInput name="code"
                  id="" (focus)="codeFocus = true" (blur)="codeBlur($event)" formControlName="code"></p>
              <p *ngIf="!editcode">{{ code }}</p>
              <p class="ion-float-end" *ngIf="editcode && form.get('code').valid" (click)="setEditCode(); Save()  ">
                <ion-button color="success">
                  <ion-icon name="checkmark-circle" color="light"></ion-icon>
                </ion-button>
              </p>
              <p class="ion-float-end" *ngIf="editcode" (click)="setEditCode(); resetCode() ">
                <ion-button color="danger">
                  <ion-icon name="close-circle" color="light"></ion-icon>
                </ion-button>
              </p>
            </ion-label>
            <p class="ion-float-end" *ngIf="!editcode" (click)="setEditCode()">
              <ion-icon name="create-outline" mode="md" color="black"></ion-icon>
            </p>


          </ion-item>



          <!-- <ion-item *ngIf="socid" lines="none" style="text-align: center;">
          <ion-button  color="danger" *ngIf="codeFocus || streetFocus || townFocus || emailFocus || phoneFocus ||nameFocus  " [disabled]="form.get('code').invalid"  expand="block" (click)="postItems()">Save</ion-button>
          </ion-item>  -->
        </form>
        <ion-item lines="none">
          <ion-icon slot="start" name="analytics-outline" color="black"></ion-icon>
          <ion-label>
            <h3 class="text-height">
              <strong>{{ 'PROFILE.NumberOrder' | translate }}</strong>

            </h3>
            <p (click)="DropOrders()">
              <b *ngIf="oldOrder.length">{{oldOrder.length}} {{ 'PROFILE.OrderCount' | translate }} </b><b
                *ngIf="gettingOrders && oldOrder.length===0">
                <ion-spinner name="dots"></ion-spinner>
              </b>
              <b class="ion-float-end" *ngIf="!droporder && oldOrder.length>0" (click)="DropOrders()"></b>
              <b class="ion-float-end" *ngIf="droporder" (click)="DropOrders()"></b>
            </p>
            <ion-grid *ngIf="oldOrder && droporder" style="overflow: auto;">
              <ion-row>
                <ion-col *ngFor="let order of oldOrder">
                  <ion-button color="" (click)="showOldOrder(order.lines,order.id,order.total_ht)">Order {{order.id}}
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-label>


        </ion-item>
        <ion-item lines="none">
          <ion-icon slot="start" name="analytics-outline" color="black"></ion-icon>
          <ion-label>
            <h3 class="text-height">
              <strong>{{ 'PROFILE.NumberBooking' | translate }}</strong>
            </h3>
            <p (click)="DropBooking()">
              <b *ngIf="oldBooking.length">{{oldBooking.length}} {{ 'PROFILE.BookingCount' | translate }} </b> <b
                *ngIf="gettingOrders && oldBooking.length === 0">
                <ion-spinner name="dots"></ion-spinner>
              </b>
              <b class="ion-float-end" *ngIf="!dropbooking && oldBooking.length>0" (click)="DropBooking()"></b>
              <!-- <b class="ion-float-end" *ngIf="dropbooking"  (click)="DropBooking()"></b> -->
            </p>
            <ion-grid *ngIf="oldBooking && dropbooking" style="overflow: auto;">
              <ion-row>
                <ion-col *ngFor="let booking of oldBooking">
                  <ion-button color="" (click)="showOldBooking(booking.label,booking.type,booking.id)"> Booking
                    {{booking.id}}</ion-button>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-label>
        </ion-item>
      </ion-list>
    </div>
  </div>

</ion-content>

<ng-template #templateName>
  <ion-content>
    <div class="main-container">
      <img src="../../../assets/icon/no_profile.svg" alt="No Orders" id="image-top"
        style="width: 90%; margin: auto; margin-bottom: 1em;">
      <div style="text-align: center;">
        <div style="font-size: 22px; font-weight: bold; width: 90%; margin: auto; margin-bottom: 1em;">
          {{'PROFILE.NO_USER_FOUND' | translate}}</div>
        <div style="font-size: 15px; font-weight: 400; width: 90%; margin: auto;">{{'PROFILE.BOOKORORDERDESC' |
          translate}}</div>
        <ion-button color="primary" expand="block" 
        style="margin-top: 2em; margin-left: auto;
        margin-right: auto;
        width: 90%;" (click)="home()">
          {{'PROFILE.BOOKORORDER' | translate}}
        </ion-button>
      </div>
    </div>
  </ion-content>
</ng-template>